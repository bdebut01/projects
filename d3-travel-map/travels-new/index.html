<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Done with help from the below tutorials:

	D3.js - animated U.S. states border map :
		https://github.com/maptime-ams/animated-borders-d3js

	Mike Bostockâ€™s "World Map" :
		https://bl.ocks.org/mbostock/4180634 

	World map data obtained from Natural Earth Data :
		https://www.naturalearthdata.com/downloads/50m-cultural-vectors/

	Country ISO_A3 list : 
		https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3

	 -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

	<script src="//d3js.org/d3.v3.min.js"></script>
	<script src="//d3js.org/d3.geo.projection.v0.min.js"></script>
	<script src="//d3js.org/topojson.v1.min.js"></script>
	<script src="//d3js.org/queue.v1.min.js"></script>

	<link href="static/main.css" rel="stylesheet">

	<script src="static/chroniton.js"></script>
	<link href="static/chroniton.css" rel="stylesheet">
	<style>
  
	</style>
	<title>Ben's Global Travel Map w/ Slider</title>
</head>
<body>
	<svg>
  	<g id="countries"></g>
	</svg>
	<h1>Ben in <span id="currentdate">Jan 2002</span></h1>
	<h2></h2>
	<div id="slider">
	</div>	
	<script>
	  var svgCountries = d3.select("svg #countries"),
	    countries = {},
	    selectedDate = new Date('2002-01'),
	   	datePrintOptions = {month: 'short', year: 'numeric' }

		var width = window.innerWidth,
	  	height = window.innerHeight;

	  // Very easy to play with different projections by changing this line
	  var projection = d3.geo.kavrayskiy7()
	    .scale(225)
	    .translate([width / 2, height / 1.7]) // cutting off Antarctica
	    .precision(.1);

	  var path = d3.geo.path()
	      .projection(projection);

		queue()
			.defer(d3.json, "data/topoworld.json")
			.defer(d3.json, "data/travels-data.json")
			.await(ready);

		function ready(error, world, travels) {
			if (error) throw error;

	  	var countries = topojson.feature(world, world.objects.countries).features;
	  	
	  	function update() {
			  svgCountries.selectAll(".country")
			      .data(countries)
			    .enter().insert("path")
			      .attr("d", path)
			      .attr("class", "country")
			      .attr("id", function(d) {
			      		if(d.properties.ISO_A3 in travels) return "visited";
			      		return "unvisited";
			      })
			      .on("mouseover", function(d){
	            d3.select("h2").text(d.properties.NAME);
	        	})
	        	.on("mouseout", function(d){
	            d3.select("h2").text("");
	        	});
	    }

	    update();

	    d3.select("#slider")
          .call(
            chroniton()
              .domain([new Date(selectedDate), new Date()])
              .labelFormat(function(date) {
                return convertToDateString(date)
              })
              .width(600)
              .on('change', function(date) {
                var newDate = date;
                if (convertToDateString(newDate) != convertToDateString(selectedDate)) {
                  selectedDate = newDate
                  console.log("set selectedDate to: " + selectedDate)
                  d3.select("#currentdate").html(convertToDateString(selectedDate))
                  // svgStates.selectAll("path").remove();
                  // update();
                }
              })
              .playButton(true)
              .playbackRate(0.2)
              .loop(true)
          );
		}

		function convertToDateString(inputDate) {
			return inputDate.toLocaleDateString('US-en', datePrintOptions)
		}
</script>
</body>
</html>






